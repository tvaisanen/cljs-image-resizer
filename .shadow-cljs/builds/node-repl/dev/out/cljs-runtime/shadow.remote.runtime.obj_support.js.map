{"version":3,"sources":["shadow/remote/runtime/obj_support.cljc"],"mappings":"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","names":["this__4415__auto__","k__4416__auto__","this__4417__auto__","k33589","else__4418__auto__","G__33595","cljs.core/Keyword","obj","cljs.core.get","__extmap","this__4434__auto__","f__4435__auto__","init__4436__auto__","cljs.core.reduce","ret__4437__auto__","p__33602","vec__33608","k__4438__auto__","cljs.core.nth","v__4439__auto__","this__4429__auto__","writer__4430__auto__","opts__4431__auto__","pr-pair__4432__auto__","keyval__4433__auto__","cljs.core/pr-sequential-writer","cljs.core.concat","cljs.core/PersistentVector","G__33588","cljs.core/RecordIter","cljs.core/-iterator","cljs.core/nil-iter","this__4413__auto__","__meta","this__4410__auto__","__hash","this__4419__auto__","cljs.core/count","this__4411__auto__","h__4273__auto__","coll__4412__auto__","cljs.core/hash-unordered-coll","this33590","other33591","cljs.core._EQ_","this__4424__auto__","k__4425__auto__","cljs.core/contains?","cljs.core.dissoc","cljs.core/-with-meta","cljs.core.into","cljs.core/not-empty","this__4422__auto__","k__4423__auto__","pred__33659","cljs.core/keyword-identical?","expr__33660","cljs.core.assoc","this__4427__auto__","cljs.core/seq","cljs.core/MapEntry","this__4414__auto__","this__4420__auto__","entry__4421__auto__","cljs.core/vector?","cljs.core/-nth","cljs.core/-conj","shadow.remote.runtime.obj-support/Reference","this__4458__auto__","cljs.core/List","writer__4459__auto__","cljs.core/-write","G__33592","extmap__4454__auto__","G__33678","cljs.core/record?","shadow.remote.runtime.obj-support/->Reference","shadow.remote.runtime.obj-support/map->Reference","shadow.remote.runtime.obj-support/obj-ref","shadow.remote.runtime.obj-support/obj-ref?","result","shadow.remote.runtime.obj-support/now","js/Date.now","shadow.remote.runtime.obj-support/next-oid","cljs.core/random-uuid","shadow.remote.runtime.obj-support/register*","state","oid","obj-info","ts","obj-entry","cljs.core/assoc-in","shadow.remote.runtime.obj-support/obj-type-string","cljs.core.pr_str","cljs.core/type","js/shadow","js/shadow.remote","js/shadow.remote.runtime","js/shadow.remote.runtime.obj-support","js/shadow.remote.runtime.obj-support.make-view","method-table__4654__auto__","cljs.core.atom","prefer-table__4655__auto__","method-cache__4656__auto__","cached-hierarchy__4657__auto__","hierarchy__4658__auto__","fexpr__33680","cljs.core/MultiFn","cljs.core.symbol","shadow.remote.runtime.obj-support/make-view","p__33681","map__33682","cljs.core/--destructure-map","state-ref","view-type","msg","entry","shadow.remote.runtime.obj-support/default-max-print-size","p__33683","map__33684","shadow.remote.runtime.obj-support/as-edn","data","limit","lw","shadow.remote.runtime.writer/limit-writer","cljs.core/pr-writer","cljs.core/pr-opts","shadow.remote.runtime.writer/get-string","p__33687","map__33692","shadow.remote.runtime.obj-support/as-pprint","cljs.pprint.pprint","p__33693","map__33694","shadow.remote.runtime.obj-support/as-edn-limit","shadow.remote.runtime.writer/pr-str-limit","shadow.remote.runtime.obj-support/as-str","shadow.remote.runtime.obj-support/as-ex-str","ex","cljs.repl/error->str","shadow.remote.runtime.obj-support/exception?","x","js/Error","shadow.remote.runtime.obj-support/attempt-to-sort","desc","coll","e33695","cljs.core/vec","cljs.core.sort","e","p__33696","map__33697","shadow.remote.runtime.obj-support/browseable-kv","view-order","p__33698","map__33699","idx","key","val","nav","clojure.datafy/nav","p__33705","map__33706","start","num","key-limit","val-limit","end","x__4252__auto__","y__4253__auto__","idxs","cljs.core.range","fragment","m","e33707","e33708","p__33709","map__33710","shadow.remote.runtime.obj-support/browseable-vec","p__33711","map__33712","p__33713","map__33714","p__33715","map__33716","shadow.remote.runtime.obj-support/browseable-seq","p__33717","map__33718","p__33719","map__33720","p__33726","map__33727","shadow.remote.runtime.obj-support/pageable-seq","seq-state-ref","p__33728","map__33729","cljs.core/deref","p__33730","map__33731","map__33732","vec__33733","tail","realized","seq-state","missing","next","cljs.core/first","cljs.core/rest","cljs.core.conj","cljs.core.swap_BANG_","cljs.core/assoc","p__33737","map__33738","shadow.remote.runtime.obj-support/inspect-basic","opts","e33739","cljs.core.update","cljs.core/merge","cljs.core/boolean?","cljs.core/Symbol","cljs.core/map?","cljs.core/keys","cljs.core/set?","cljs.core/list?","cljs.core/seq?","shadow.remote.runtime.obj-support/inspect-type-info","shadow.remote.runtime.obj-support/inspect-source-info","cljs.core/select-keys","p__33741","map__33742","shadow.remote.runtime.obj-support/add-summary-op","summary","shadow.remote.runtime.obj-support/default-describe","o","clojure.datafy/datafy","p1__33746#","p1__33747#","p1__33748#","G__33757","cljs.core/coll?","p1__33749#","p1__33750#","goog.object/set","shadow.remote.runtime.api/Inspectable","shadow.remote.runtime.api/describe","p__33758","map__33759","shadow.remote.runtime.obj-support/add-supports","handlers","cljs.core/set","p__33760","map__33761","shadow.remote.runtime.obj-support/ensure-descriptor","p__33764","map__33765","shadow.remote.runtime.obj-support/get-tap-history","svc","cljs.core/vals","p1__33762#","cljs.core.filter","cljs.core.get_in","p1__33763#","cljs.core.sort_by","cljs.core/reverse","cljs.core.take","cljs.core.map","p__33766","map__33767","shadow.remote.runtime.obj-support/obj-describe*","cljs.core/update-in","p__33769","p__33770","map__33771","map__33772","shadow.remote.runtime.obj-support/obj-describe","runtime","temp__5733__auto__","shadow.remote.runtime.shared/reply","p__33776","p__33777","map__33778","map__33779","shadow.remote.runtime.obj-support/obj-request","this","request-op","request-fn","cljs.core/not","e33781","new-oid","new-entry","reply-msg","G__33787","js/console.warn","G__33783","G__33785","G__33786","shadow.remote.runtime.obj-support/register","p__33791","p__33792","map__33793","map__33794","shadow.remote.runtime.obj-support/obj-forget","cljs.core/update","cljs.core/dissoc","p__33795","map__33796","shadow.remote.runtime.obj-support/obj-forget-all","shadow.remote.runtime.obj-support/basic-gc!","objs-to-drop","cljs.core.drop","shadow.remote.runtime.obj-support/start","p1__33797#","p1__33798#","p1__33799#","p1__33800#","shadow.remote.runtime.api/add-extension","p__33804","map__33805","cljs.core.merge","p__33806","map__33807","shadow.remote.runtime.obj-support/get-ref","obj-id","p__33808","map__33809","shadow.remote.runtime.obj-support/stop","shadow.remote.runtime.api/del-extension"],"sourcesContent":["(ns shadow.remote.runtime.obj-support\n  (:require\n    [clojure.datafy :as d]\n    [clojure.pprint :refer (pprint)]\n    [clojure.spec.alpha :as spec]\n    [shadow.remote.runtime.api :as p]\n    [shadow.remote.runtime.shared :as shared]\n    [shadow.remote.runtime.writer :as lw]\n    ;; FIXME: I do not like importing these here\n    ;; need to extract shadow-cljs functions if I ever move shadow.remote out\n    ;; cljs.repl has way too much other stuff on the CLJ side not error related we don't really need here\n    ;; should just have one namespace only concerned with formatting errors\n    ;; maybe even as separate plugin\n    #?@(:clj [[shadow.cljs.devtools.errors :refer (error-format)]\n              [shadow.jvm-log]]\n        :cljs [[cljs.repl :refer (error->str)]]))\n  #?(:clj (:import [java.util UUID])))\n\n(defrecord Reference [obj])\n\n(defn obj-ref [obj]\n  (when (some? obj)\n    (Reference. obj)))\n\n(defn obj-ref? [result]\n  (instance? Reference result))\n\n(defn now []\n  #?(:clj\n     (System/currentTimeMillis)\n     :cljs\n     (js/Date.now)))\n\n(defn next-oid []\n  #?(:clj\n     (str (UUID/randomUUID))\n     :cljs\n     (str (random-uuid))))\n\n(defn register*\n  [state oid obj obj-info]\n\n  (let [ts (now)\n\n        obj-entry\n        {:oid oid\n         :obj obj\n         ;; tracking that for GC purposes\n         :access-at ts\n         :obj-info (assoc obj-info :added-at ts)}]\n\n    (assoc-in state [:objects oid] obj-entry)))\n\n(declare register)\n\n(defn obj-type-string [obj]\n  (if (nil? obj)\n    \"nil\"\n    #?(:clj\n       (-> (class obj) (.getName))\n       :cljs\n       (pr-str (type obj)))))\n\n(defmulti make-view\n  (fn [state-ref {:keys [view-type] :as msg} entry]\n    view-type))\n\n;; 1meg?\n(def default-max-print-size (* 1 1024 1024))\n\n(defn as-edn\n  [data {:keys [limit] :or {limit default-max-print-size} :as msg}]\n  (let [lw (lw/limit-writer limit)]\n    #?(:clj\n       (print-method data lw)\n       :cljs\n       (pr-writer data lw (pr-opts)))\n    (lw/get-string lw)))\n\n(defn as-pprint\n  [data {:keys [limit] :or {limit default-max-print-size} :as msg}]\n  ;; CLJ pprint for some reason doesn't run out of memory when printing circular stuff\n  ;; but it never finishes either\n  (let [lw (lw/limit-writer limit)]\n    (pprint data lw)\n    (lw/get-string lw)))\n\n(defn as-edn-limit\n  [data {:keys [limit] :as msg}]\n  (lw/pr-str-limit data limit))\n\n;; FIXME: should likely support limit options\n(defn as-str\n  [data msg]\n  (str data))\n\n(defn as-ex-str [ex msg]\n  #?(:cljs\n     (error->str ex)\n\n     :clj\n     (error-format ex)))\n\n(defn exception? [x]\n  #?(:clj (instance? java.lang.Throwable x)\n     :cljs (instance? js/Error x)))\n\n(defn attempt-to-sort [desc coll]\n  (try\n    (-> desc\n        (assoc :view-order (vec (sort coll)))\n        (assoc-in [:summary :sorted] true))\n    (catch #?(:clj Exception :cljs :default) e\n      (-> desc\n          (assoc :view-order (vec coll))\n          (assoc-in [:summary :sorted] false)))))\n\n(defn browseable-kv [{:keys [view-order data] :as desc}]\n  (-> desc\n      (assoc-in [:handlers :nav]\n        (fn [{:keys [idx]}]\n          (let [key (nth view-order idx)\n                val (get data key)\n                nav (d/nav data key val)]\n            (obj-ref nav))))\n      (assoc-in [:handlers :fragment]\n        (fn [{:keys [start num key-limit val-limit]\n              :or {key-limit 100\n                   val-limit 100}\n              :as msg}]\n\n          (let [end (min (count view-order) (+ start num))\n                idxs (range start end)\n                fragment\n                (reduce\n                  (fn [m idx]\n                    (let [key (nth view-order idx)\n                          val (get data key)]\n                      (assoc m idx {:key (try\n                                           (lw/pr-str-limit key key-limit)\n                                           (catch #?(:clj Exception :cljs :default) e\n                                             [true \"... print failed ...\"]))\n                                    :val (try\n                                           (lw/pr-str-limit val val-limit)\n                                           (catch #?(:clj Exception :cljs :default) e\n                                             [true \"... print failed ...\"]))})))\n                  {}\n                  idxs)]\n\n            fragment)))))\n\n(defn browseable-vec [{:keys [data] :as desc}]\n  (-> desc\n      (assoc-in [:handlers :nav]\n        (fn [{:keys [idx]}]\n          (let [val (nth data idx)\n                nav (d/nav data idx val)]\n            (obj-ref nav))))\n      (assoc-in [:handlers :fragment]\n        (fn [{:keys [start num val-limit]\n              :or {val-limit 100}\n              :as msg}]\n\n          (let [end (min (count data) (+ start num))\n                idxs (range start end)\n                fragment\n                (reduce\n                  (fn [m idx]\n                    (let [val (nth data idx)]\n                      (assoc m idx {:val (lw/pr-str-limit val val-limit)})))\n                  {}\n                  idxs)]\n\n            fragment)))))\n\n(defn browseable-seq [{:keys [data view-order] :as desc}]\n  (-> desc\n      (assoc-in [:handlers :nav]\n        (fn [{:keys [idx]}]\n          (let [val (nth view-order idx)\n                nav (d/nav data idx val)]\n            (obj-ref nav))))\n      (assoc-in [:handlers :fragment]\n        (fn [{:keys [start num val-limit]\n              :or {val-limit 100}\n              :as msg}]\n\n          (let [end (min (count view-order) (+ start num))\n                idxs (range start end)\n                fragment\n                (reduce\n                  (fn [m idx]\n                    (let [val (nth view-order idx)]\n                      (assoc m idx {:val (lw/pr-str-limit val val-limit)})))\n                  {}\n                  idxs)]\n\n            fragment)))))\n\n(defn pageable-seq [{:keys [data] :as desc}]\n  ;; data is always beginning of seq\n  (let [seq-state-ref\n        (atom {:tail data ;; track where we are at\n               :realized []})]\n    (-> desc\n        (assoc :seq-state-ref seq-state-ref)\n        (assoc-in [:handlers :nav]\n          (fn [{:keys [idx]}]\n            ;; FIXME: should validate that idx is actually realized\n            (let [val (nth (:realized @seq-state-ref) idx)\n                  ;; FIXME: not sure there are many cases where lazy seqs actually have nav?\n                  nav (d/nav data idx val)]\n              (obj-ref nav))))\n        (assoc-in [:handlers :chunk]\n          (fn [{:keys [start num val-limit]\n                :or {val-limit 100}\n                :as msg}]\n\n            ;; need locking otherwise threads may realize more than once\n            ;; shouldn't be much of an issue but better be safe\n            (locking seq-state-ref\n              (let [{:keys [tail realized] :as seq-state} @seq-state-ref\n\n                    end (+ start num)\n                    missing (- end (count realized))\n\n                    [tail realized]\n                    (loop [tail tail\n                           realized realized\n                           missing missing]\n                      (if-not (pos? missing)\n                        [tail realized]\n                        (let [next (first tail)]\n                          (if (nil? next)\n                            [nil realized]\n                            (recur (rest tail) (conj realized next) (dec missing))))))\n\n                    idxs (range start (min end (count realized)))\n                    fragment\n                    (reduce\n                      (fn [m idx]\n                        (let [val (nth realized idx)]\n                          (assoc m idx {:val (lw/pr-str-limit val val-limit)})))\n                      {}\n                      idxs)]\n\n                (swap! seq-state-ref assoc :tail tail :realized realized)\n\n                {:start start\n                 :realized (count realized)\n                 :fragment fragment\n                 :more? (or (> (count realized) end) (some? tail))})))))))\n\n(comment\n  (def x (pageable-seq {:data (map (fn [x] (prn [:realize x]) x) (range 10))}))\n\n  (let [chunk (get-in x [:handlers :chunk])]\n    (chunk {:start 0 :num 5})\n    )\n\n  (let [chunk (get-in x [:handlers :chunk])]\n    (chunk {:start 5 :num 10})\n    ))\n\n(defn inspect-basic [{:keys [data] :as desc} obj opts]\n  (try\n    (cond\n      (nil? data)\n      (assoc-in desc [:summary :data-type] :nil)\n\n      (string? data)\n      (-> desc\n          (update :summary merge {:data-type :string\n                                  :length (count data)})\n          ;; FIXME: substring support?\n          (assoc-in [:handlers :get-value] (fn [msg] data)))\n\n      (boolean? data)\n      (-> desc\n          (assoc-in [:summary :data-type] :boolean)\n          (assoc-in [:handlers :get-value] (fn [msg] data)))\n\n      (number? data)\n      (-> desc\n          (assoc-in [:summary :data-type] :number)\n          (assoc-in [:handlers :get-value] (fn [msg] data)))\n\n      (keyword? data)\n      (-> desc\n          (assoc-in [:summary :data-type] :keyword)\n          (assoc-in [:handlers :get-value] (fn [msg] data)))\n\n      (symbol? data)\n      (-> desc\n          (assoc-in [:summary :data-type] :symbol)\n          (assoc-in [:handlers :get-value] (fn [msg] data)))\n\n      (map? data)\n      (-> desc\n          (update :summary merge {:data-type :map\n                                  :entries (count data)})\n          (attempt-to-sort (keys data))\n          (browseable-kv))\n\n      (vector? data)\n      (-> desc\n          (update :summary merge {:data-type :vec\n                                  :entries (count data)})\n          (browseable-vec))\n\n      (set? data)\n      (-> desc\n          (update :summary merge {:data-type :set\n                                  :entries (count data)})\n          (attempt-to-sort data)\n          (browseable-seq))\n\n      (list? data)\n      (-> desc\n          (update :summary merge {:data-type :list\n                                  :entries (count data)})\n          (assoc :view-order (vec data))\n          (browseable-seq))\n\n      ;; lazy seqs\n      (seq? data)\n      (-> desc\n          (update :summary merge {:data-type :lazy-seq})\n          (pageable-seq))\n\n      ;; FIXME: records?\n\n      :else\n      (assoc-in desc [:summary :data-type] :unsupported))\n\n    (catch #?(:cljs :default :clj Exception) e\n      (assoc-in desc [:summary :data-type] :unsupported))))\n\n(defn inspect-type-info [desc obj opts]\n  (assoc-in desc [:summary :obj-type] (obj-type-string obj)))\n\n(defn inspect-source-info [desc obj opts]\n  (update desc :summary merge (select-keys opts [:ns :line :column :label])))\n\n(defn add-summary-op [{:keys [summary] :as desc}]\n  (assoc-in desc [:handlers :summary] (fn [msg] summary)))\n\n(defn default-describe [o opts]\n  (let [data (d/datafy o)]\n\n    (-> {:data data\n         :summary\n         {:added-at (:added-at opts)\n          :datafied (not (identical? data o))}\n\n         ;; FIXME: should these work on the datafy result or the original?\n         ;; maybe different ops? maybe msg option?\n         :handlers\n         (-> {:str #(as-str o %)\n              ;; FIXME: only do those for actual clojure vals?\n              :edn #(as-edn o %)\n              :edn-limit #(as-edn-limit o %)}\n             (cond->\n               (or (coll? o) (seq? o))\n               (assoc :pprint #(as-pprint o %))\n\n               (exception? o)\n               (assoc :ex-str #(as-ex-str o %))\n               ))}\n\n        (inspect-basic o opts)\n        (inspect-type-info o opts)\n        (inspect-source-info o opts)\n        (add-summary-op))))\n\n(extend-protocol p/Inspectable\n  #?(:clj Object :cljs default)\n  (describe [o opts]\n    (default-describe o opts))\n\n  nil\n  (describe [o opts]\n    (default-describe o opts)))\n\n(comment\n  (p/describe\n    {:hello \"world\"}\n    {:added-at \"NOW\" :ns \"foo.bar\"}))\n\n;; called after describe so impls don't have to worry about this\n(defn add-supports [{:keys [handlers] :as desc}]\n  (assoc-in desc [:summary :supports] (set (keys handlers))))\n\n;; FIXME: this is running inside swap! which means it can potentially\n;; end up getting executed several times for the same object (in CLJ)\n;; that is not great and should be handled differently\n(defn ensure-descriptor [{:keys [obj obj-info desc] :as entry}]\n  (if desc\n    entry\n    (assoc entry :desc (-> (p/describe obj obj-info)\n                           (add-supports)))))\n\n(defn get-tap-history [{:keys [state-ref] :as svc} num]\n  (->> (:objects @state-ref)\n       (vals)\n       (filter #(= :tap (get-in % [:obj-info :from])))\n       (sort-by #(get-in % [:obj-info :added-at]))\n       (reverse)\n       (take num)\n       (map :oid)\n       (into [])))\n\n(defn obj-describe*\n  [{:keys [state-ref]}\n   oid]\n  (when (contains? (:objects @state-ref) oid)\n    (swap! state-ref update-in [:objects oid] ensure-descriptor)\n    (swap! state-ref assoc-in [:objects oid :access-at] (now))\n    (let [summary (get-in @state-ref [:objects oid :desc :summary])]\n      summary)))\n\n(defn obj-describe\n  [{:keys [runtime] :as svc}\n   {:keys [oid] :as msg}]\n  (if-let [summary (obj-describe* svc oid)]\n    (shared/reply runtime msg {:op :obj-summary\n                               :oid oid\n                               :summary summary})\n    (shared/reply runtime msg {:op :obj-not-found :oid oid})))\n\n(defn obj-request\n  [{:keys [state-ref runtime] :as this}\n   {:keys [oid request-op] :as msg}]\n  (if-not (contains? (:objects @state-ref) oid)\n    (shared/reply runtime msg {:op :obj-not-found :oid oid})\n    (do (swap! state-ref update-in [:objects oid] ensure-descriptor)\n        (swap! state-ref assoc-in [:objects oid :access-at] (now))\n        (let [entry (get-in @state-ref [:objects oid])\n              request-fn (get-in entry [:desc :handlers request-op])]\n          (if-not request-fn\n            (shared/reply runtime msg {:op :obj-request-not-supported\n                                       :oid oid\n                                       :request-op request-op})\n            (try\n              (let [result (request-fn msg)]\n\n                ;; FIXME: add support for generic async results\n                ;; all handlers should already be sync but allow async results\n                (if-not (obj-ref? result)\n                  (shared/reply runtime msg\n                    {:op :obj-result\n                     :oid oid\n                     :result result})\n\n                  (let [new-oid (next-oid)\n                        ts (now)\n\n                        new-entry\n                        {:oid new-oid\n                         :obj (:obj result)\n                         :access-at ts\n                         ;; FIXME: should keep some info on how this ref came to be\n                         :obj-info {:added-at ts\n                                    :added-via oid}}]\n\n                    (swap! state-ref assoc-in [:objects new-oid] new-entry)\n\n                    (let [reply-msg\n                          (-> {:op :obj-result-ref\n                               :oid oid\n                               :ref-oid new-oid}\n                              (cond->\n                                ;; only send new-obj :summary when requested\n                                (:summary msg)\n                                (assoc :summary (obj-describe* this new-oid))))]\n\n                      (shared/reply runtime msg reply-msg)))))\n\n              (catch #?(:clj Exception :cljs :default) e\n                #?(:cljs (js/console.warn \"action-request-action failed\" (:obj entry) e)\n                   :clj (shadow.jvm-log/warn-ex e ::obj-request-failed msg))\n                (shared/reply runtime msg\n                  {:op :obj-request-failed\n                   :oid oid\n                   :msg msg\n                   :ex-oid (register this e {:msg msg})})))))\n        )))\n\n(defn obj-forget\n  [{:keys [state-ref] :as svc}\n   {:keys [oid] :as msg}]\n  (swap! state-ref update :objects dissoc oid))\n\n(defn obj-forget-all\n  [{:keys [state-ref] :as svc}\n   msg]\n  (swap! state-ref assoc :objects {}))\n\n(defn basic-gc! [state]\n  (let [objs-to-drop\n        (->> (:objects state)\n             (vals)\n             (sort-by :access-at)\n             (reverse)\n             (drop 100) ;; FIXME: make configurable\n             (map :oid))]\n\n    (reduce\n      (fn [state oid]\n        (update state :objects dissoc oid))\n      state\n      objs-to-drop)))\n\n(defn start [runtime]\n  (let [state-ref (atom {:objects {}\n                         :id-seq-ref 0})\n\n        svc\n        {:runtime runtime\n         :state-ref state-ref}]\n\n    (p/add-extension runtime\n      ::ext\n      {:ops {:obj-describe #(obj-describe svc %)\n             :obj-request #(obj-request svc %)\n             :obj-forget #(obj-forget svc %)\n             :obj-forget-all #(obj-forget-all svc %)}\n       :on-idle #(swap! state-ref basic-gc!)})\n\n    svc))\n\n(defn register [{:keys [state-ref] :as svc} obj obj-info]\n  (let [oid (next-oid)]\n    (if-not (and (vector? obj) (= :shadow.remote/wrap (first obj)) (= (count obj) 3))\n      (swap! state-ref register* oid obj obj-info)\n      (swap! state-ref register* oid (nth obj 1) (merge obj-info (nth obj 2))))\n    oid))\n\n(defn get-ref [{:keys [state-ref]} obj-id]\n  (get-in @state-ref [:objects obj-id]))\n\n(defn stop [{:keys [runtime]}]\n  (p/del-extension runtime ::ext))\n\n(comment\n  (def obj-support (:clj-runtime-obj-support (shadow.cljs.devtools.server.runtime/get-instance)))\n  (swap! (:state-ref obj-support) assoc :objects {})\n  )"]}